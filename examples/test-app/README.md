# gas-sheets-query Test App

A test app for comprehensive testing of gas-sheets-query library features in Google Sheets + Apps Script environment.

## ğŸ“ Structure

```
test-app/
â”œâ”€â”€ schema.gsq.yaml       # Schema definition (User, Project, Task, Comment)
â”œâ”€â”€ appsscript.json       # GAS manifest
â”œâ”€â”€ src/
â”‚   â””â”€â”€ Code.ts           # GAS entry point + test functions
â”œâ”€â”€ generated/            # Files generated by gsquery generate
â”‚   â”œâ”€â”€ types.ts
â”‚   â”œâ”€â”€ client.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ README.md
```

## ğŸš€ Deployment

### 1. Install and Login to clasp

```bash
npm install -g @google/clasp
clasp login
```

### 2. Create Google Sheets

1. Create a new spreadsheet at [Google Sheets](https://sheets.google.com)
2. Copy the spreadsheet ID (from URL: `https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}/edit`)

### 3. Create Apps Script Project

```bash
cd examples/test-app

# Create new GAS project
clasp create --type sheets --title "GSQ Test App" --parentId "{SPREADSHEET_ID}"

# Or connect to existing project
clasp clone {SCRIPT_ID}
```

### 4. Generate Code and Push

```bash
# Generate types and client from schema
cd ../..
npx gsquery generate examples/test-app/schema.gsq.yaml -o examples/test-app/generated

# Push to GAS
cd examples/test-app
clasp push
```

### 5. Run Tests

1. Open Apps Script editor with `clasp open`
2. Run `testConnection` function to verify connection
3. Run `setupTestData` function to create test data
4. Run `runAllTests` function to execute all tests

## ğŸ“Š Schema Description

### User
Stores user information.
- `id`: Auto-increment ID
- `email`: Email (unique)
- `name`: Name
- `role`: Role (ADMIN, MEMBER, GUEST)

### Project
Stores project information.
- `id`: Auto-increment ID
- `name`: Project name
- `ownerId`: Owner ID (references User)
- `status`: Status (ACTIVE, ARCHIVED)

### Task
Stores task information.
- `id`: Auto-increment ID
- `title`: Title
- `projectId`: Project ID (references Project)
- `assigneeId`: Assignee ID (references User, nullable)
- `status`: Status (TODO, IN_PROGRESS, DONE)
- `priority`: Priority (LOW, MEDIUM, HIGH)
- `dueDate`: Due date (nullable)

### Comment
Stores comment information.
- `id`: Auto-increment ID
- `content`: Content
- `taskId`: Task ID (references Task)
- `authorId`: Author ID (references User)
- `createdAt`: Created timestamp

## ğŸ§ª Test Functions

| Function | Description |
|----------|-------------|
| `testConnection` | Verify spreadsheet connection |
| `setupTestData` | Initialize and insert test data |
| `testCRUD` | Test Create, Read, Update, Delete |
| `testBatch` | Test batchInsert, batchUpdate |
| `testQuery` | Test where, orderBy, limit, offset, like, in |
| `testJoin` | Test JOIN queries |
| `testAggregation` | Test count, groupBy, having |
| `runAllTests` | Run all tests |

## ğŸ“ Menu Usage

When you open the spreadsheet, a `ğŸ§ª GSQ Tests` menu will be added.
You can run each test directly from the menu.

## âš ï¸ Notes

1. **Authorization required on first run**: OAuth consent screen will appear.
2. **Spreadsheet ID setting**: Check SPREADSHEET_ID in `generated/client.ts`
3. **Quota limits**: Be aware of GAS daily quotas (read/write limits)

## ğŸ”§ Troubleshooting

### "Sheet not found" error
- Sheet has not been created yet. Run `setupTestData` first.

### Permission error
- Make sure you have edit permission on the spreadsheet.

### Type error
- If `generated/` folder is empty, run `gsquery generate`.
